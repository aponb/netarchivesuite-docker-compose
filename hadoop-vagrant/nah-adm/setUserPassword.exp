#!/usr/bin/expect
# https://community.hortonworks.com/articles/74332/how-to-automate-ldap-sync-for-ambari-1.html

set timeout 200
set user [lindex $argv 0]
set pass [lindex $argv 1]

spawn ipa user-mod ${user} --password
expect "Password: " { send "$pass\n" }
expect "Enter Password again to verify: " { send "$pass\n" }
expect eof

spawn kinit ${user} -c /tmp/${user}_ticket
expect "Password for ${user}@*:" { send "$pass\n" }
expect "Password expired.  You must change it now."
expect "Enter new password: " { send "$pass\n" }
expect "Enter it again: " { send "$pass\n" }

interact

